<!DOCTYPE html>
<html>

<head>
    <title>News Section</title>
    <link rel="stylesheet" href="../static/newsScroll.css">
    <link href="https://unpkg.com/tailwindcss@^1.0/dist/tailwind.min.css" rel="stylesheet" />
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        /* CSS for fade animation */
        .fade {
            animation-name: fade;
            animation-duration: 2s;
        }

        @keyframes fade {
            from {
                opacity: 0;
            }

            to {
                opacity: 1;
            }
        }

        .bg-primary {
            background-color: #1A202C;
        }

        .text-primary {
            color: #E2E8F0;
        }

        .bg-accent {
            background-color: #2D3748;
        }

        .hover-bg-accent {
            background-color: #4A5568;
        }

        .focus-ring-accent {
            box-shadow: 0 0 0 3px rgba(74, 85, 104, 0.5);
        }

        .rounded-md {
            border-radius: 0.375rem;
        }

        .header-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .header-container h1 {
            margin: 0;
        }

        .nav-items {
            display: flex;
            align-items: center;
        }

        .nav-item {
            margin-left: 1rem;
        }

        .nav-item select {
            border: 1px solid #2D3748;
            padding: 0.5rem 1rem;
            border-radius: 0.7rem;
            background-color: #2D3748;
            color: #E2E8F0;
        }

        .nav-item select:hover {
            background-color: #4A5568;
        }

        .nav-item a {
            background-color: #2D3748;
            color: #E2E8F0;
            padding: 0.4rem 1rem;
            border-radius: 0.7rem;
            text-decoration: none;
            display: inline-block;
        }

        .nav-item a:hover {
            background-color: #4A5568;
        }

        body {
            background-color: #1A202C;
            color: #E2E8F0;
        }

        .prev,
        .next {
            color: #E2E8F0;
        }

        .dotsbox .dot {
            background-color: #E2E8F0;
        }

        .dotsbox .dot.active {
            background-color: #4A5568;
        }

        .slide-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .chart-container {
            /* position: absolute;
            width: 45%;
            left: 50%;
            top: 15%;
            height: 450px;
            padding: 50px;
            background-color: #1A202C; */
            border: 1px solid black;
            position: absolute;
            height: 84%;
            width: 40%;
            padding: 2%;
            overflow: auto;
            background: rgb(45, 55, 72, 0.9);
            /* darker grey */
            color: #E0E0E0;
            /* light grey */
            letter-spacing: 0.5px;
            line-height: 1.6;
            top: 5%;
            left: 55%;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
            animation-name: posi;
            animation-duration: 2s;
            z-index: 1;
        }

        .txt {
            width: 45%;
            padding: 50px;
        }

        .slider {
            position: relative;
        }
    </style>
</head>

<body>
    <div class="container">

        <header class="bg-primary py-6 px-4">
            <nav class="mx-auto max-w-7xl px-2 sm:px-6 lg:px-8 header-container">
                <h1 class="text-3xl font-bold text-primary">News Section</h1>
                <div class="nav-items">
                    <div class="nav-item">
                        <select id="round-select" onchange="changeRound()">
                            {% for round in rounds %}
                            <option value="{{ round }}" {% if round==current_round %}selected{% endif %}>Round {{ round
                                }}</option>
                            {% endfor %}
                        </select>
                    </div>
                    <div class="nav-item">
                        <a href="{{ url_for('home') }}">Back</a>
                    </div>
                </div>
            </nav>
        </header>

        <div class="py-2">
            <div class="slider">

                <button id="pauseButton" onclick="togglePause()">Pause</button>
                {% for slide in slides %}
                <div class="myslide fade slide-content">
                    <img src="{{ slide.image }}" style="display:absolute;">
                    <div class="txt">
                        <h1>{{ slide.title }}</h1>
                        <p>{{ slide.content }}</p>
                    </div>
                    <div class="chart-container">
                        <canvas id="chart-{{ loop.index0 }}"></canvas>
                    </div>

                </div>
                {% endfor %}
            </div>

            <a class="prev" onclick="plusSlides(-1)">&#10094;</a>
            <a class="next" onclick="plusSlides(1)">&#10095;</a>

            <div class="dotsbox" style="text-align:center">
                {% for i in range(1, slides|length + 1) %}
                <span class="dot" onclick="currentSlide({{ i }})"></span>
                {% endfor %}
            </div>
        </div>
    </div>

    <script src="../static/newsScroll.js"></script>
    <script>
let myCharts = [];
let currentStockIndex = 0; 

// Function to create a chart
function createChart(ctx, labels, data, label, backgroundColor, borderColor) {
    return new Chart(ctx, {
        type: 'line',
        data: {
            labels: labels,
            datasets: [{
                label: label,
                data: data,
                backgroundColor: backgroundColor,
                borderColor: borderColor,
                borderWidth: 4,
                pointRadius: 8,
                fill: false
            }]
        },
        options: {
            scales: {
                y: {
                    beginAtZero: true,
                    ticks: {
                        color: '#E2E8F0'
                    }
                },
                x: {
                    ticks: {
                        color: '#E2E8F0',
                    }
                }
            },
            plugins: {
                legend: {
                    labels: {
                        color: '#E2E8F0',
                    }
                }
            },
            layout: {
                padding: {
                    left: 20,
                    right: 20,
                    top: 20,
                    bottom: 20
                }
            },
            responsive: true,
            maintainAspectRatio: false,
        }
    });
}

// Function to update charts
function updateCharts(round) {
    const stockData = {{ stock_data | tojson }};
    const labels = Array.from({ length: round }, (_, i) => `Round ${i + 1}`);
    const allStocks = Object.keys(stockData); 

    document.querySelectorAll('.chart-container canvas').forEach((canvas, index) => {
        if (myCharts[index]) {
            myCharts[index].destroy();
        }
        const currentStock = allStocks[currentStockIndex];
        const data = stockData[currentStock].slice(0, round);
        
        myCharts[index] = createChart(canvas.getContext('2d'), labels, data, currentStock, color = '#' + Math.floor(2677215).toString(16), color = '#' + Math.floor( 1677215).toString(16));
        
        currentStockIndex = (currentStockIndex + 1) % allStocks.length;
    });
}

// Function to change round
function changeRound() {
    const roundSelect = document.getElementById('round-select');
    const selectedRound = parseInt(roundSelect.value);
    updateCharts(selectedRound);
}

// Call updateCharts initially
updateCharts({{ current_round }});

// Call updateCharts periodically
setInterval(() => {
    const roundSelect = document.getElementById('round-select');
    const selectedRound = parseInt(roundSelect.value);
    updateCharts(selectedRound);
}, 4000); // Update every 5 seconds

    </script>
    
    
</body>

</html>